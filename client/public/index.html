<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enigmatic - Lightweight JavaScript Library</title>
  <style>
    :root {
      --bg: #f8fafc;
      --surface: #ffffff;
      --text: #0f172a;
      --text-muted: #64748b;
      --accent: #6366f1;
      --accent-hover: #4f46e5;
      --border: #e2e8f0;
      --code-bg: #1e293b;
      --code-text: #e2e8f0;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      font-size: 16px;
      line-height: 1.6;
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
    }
    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 24px 0;
      margin-bottom: 48px;
    }
    h1 {
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--accent), #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .tagline {
      font-size: 1.25rem;
      color: var(--text-muted);
      margin-bottom: 32px;
    }
    .badge {
      display: inline-block;
      padding: 4px 12px;
      background: var(--accent);
      color: white;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 24px;
    }
    section {
      background: var(--surface);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 32px;
      box-shadow: 0 1px 3px rgba(0,0,0,.06);
      border: 1px solid var(--border);
    }
    h2 {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text);
    }
    h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-top: 24px;
      margin-bottom: 12px;
      color: var(--text);
    }
    p {
      margin-bottom: 16px;
      color: var(--text-muted);
    }
    ul, ol {
      margin-left: 24px;
      margin-bottom: 16px;
      color: var(--text-muted);
    }
    li {
      margin-bottom: 8px;
    }
    code {
      background: var(--code-bg);
      color: var(--code-text);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: ui-monospace, monospace;
      font-size: 0.9em;
    }
    pre {
      background: var(--code-bg);
      color: var(--code-text);
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 16px 0;
      font-family: ui-monospace, monospace;
      font-size: 0.875rem;
      line-height: 1.6;
    }
    pre code {
      background: none;
      padding: 0;
    }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      background: var(--accent);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      transition: background 0.15s;
      margin-right: 12px;
      margin-bottom: 12px;
    }
    .btn:hover {
      background: var(--accent-hover);
    }
    .btn-secondary {
      background: var(--border);
      color: var(--text);
    }
    .btn-secondary:hover {
      background: #cbd5e1;
    }
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }
    .feature {
      padding: 20px;
      background: var(--bg);
      border-radius: 8px;
      border: 1px solid var(--border);
    }
    .feature h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text);
    }
    .feature p {
      font-size: 0.9375rem;
      margin: 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    th {
      font-weight: 600;
      color: var(--text);
      background: var(--bg);
    }
    td {
      color: var(--text-muted);
      font-size: 0.9375rem;
    }
    .links {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 24px;
    }
    footer {
      text-align: center;
      padding: 48px 0;
      color: var(--text-muted);
      font-size: 0.875rem;
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="container">
      <span class="badge">v0.35.0</span>
      <h1>Enigmatic</h1>
      <p class="tagline">A lightweight client-side JavaScript library for DOM manipulation, reactive state management, and API interactions, with an optional Bun server for backend functionality.</p>
      <div class="links">
        <a href="api.html" class="btn">Try Demo</a>
        <a href="https://www.npmjs.com/package/enigmatic" class="btn btn-secondary" target="_blank">View on npm</a>
      </div>
    </div>
  </header>

  <div class="container">
    <section>
      <h2>Quick Start</h2>
      <h3>Using client.js via CDN</h3>
      <p>Include <code>client.js</code> in any HTML file using the unpkg CDN:</p>
      <pre><code>&lt;script src="https://unpkg.com/enigmatic"&gt;&lt;/script&gt;
&lt;script src="https://unpkg.com/enigmatic/client/public/custom.js"&gt;&lt;/script&gt;
&lt;script&gt;
  window.api_url = 'https://your-server.com';
  window.state.message = 'Hello World';
&lt;/script&gt;</code></pre>

      <h3>Using the Bun Server</h3>
      <p>The Bun server provides a complete backend with:</p>
      <ul>
        <li><strong>Key-value storage</strong> – Per-user KV persisted as append-only JSONL</li>
        <li><strong>File storage</strong> – Per-user files via Cloudflare R2 (or S3-compatible API)</li>
        <li><strong>Authentication</strong> – Auth0 OAuth2 login/logout</li>
        <li><strong>Static files</strong> – Served from <code>client/public/</code></li>
      </ul>

      <h3>Installation</h3>
      <ol>
        <li>Install <a href="https://bun.sh" target="_blank">Bun</a>:
          <pre><code>curl -fsSL https://bun.sh/install | bash</code></pre>
        </li>
        <li>Install dependencies:
          <pre><code>bun install</code></pre>
        </li>
        <li>TLS certificates: place <code>cert.pem</code> and <code>key.pem</code> in <code>server/certs/</code> for HTTPS</li>
      </ol>

      <h3>Running the Server</h3>
      <pre><code>npm start
# or
npx enigmatic
# or with hot reload
npm run hot</code></pre>
      <p>Server runs at <strong>https://localhost:3000</strong> (HTTPS is required for Auth0 cookies).</p>
    </section>

    <section>
      <h2>Features</h2>
      <div class="features">
        <div class="feature">
          <h4>DOM Utilities</h4>
          <p>Simple selectors: <code>window.$</code>, <code>window.$$</code>, <code>window.$c</code></p>
        </div>
        <div class="feature">
          <h4>Reactive State</h4>
          <p>Proxy-based state management that automatically updates DOM elements</p>
        </div>
        <div class="feature">
          <h4>Custom Elements</h4>
          <p>Automatic initialization and reactive updates for custom HTML elements</p>
        </div>
        <div class="feature">
          <h4>KV Storage</h4>
          <p>Simple key-value operations: <code>get</code>, <code>set</code>, <code>delete</code></p>
        </div>
        <div class="feature">
          <h4>File Storage</h4>
          <p>Upload, download, list, and delete files via R2/S3-compatible storage</p>
        </div>
        <div class="feature">
          <h4>Authentication</h4>
          <p>Built-in Auth0 OAuth2 integration with login/logout</p>
        </div>
      </div>
    </section>

    <section>
      <h2>API Endpoints</h2>
      <table>
        <thead>
          <tr>
            <th>Method</th>
            <th>Path</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>GET</td>
            <td><code>/</code></td>
            <td>Serves index.html</td>
          </tr>
          <tr>
            <td>GET</td>
            <td><code>/login</code></td>
            <td>Redirects to Auth0 login</td>
          </tr>
          <tr>
            <td>GET</td>
            <td><code>/callback</code></td>
            <td>Auth0 OAuth callback</td>
          </tr>
          <tr>
            <td>GET</td>
            <td><code>/logout</code></td>
            <td>Logs out and clears session</td>
          </tr>
          <tr>
            <td>GET</td>
            <td><code>/me</code></td>
            <td>Current user or 401 (no auth)</td>
          </tr>
          <tr>
            <td>GET</td>
            <td><code>/{key}</code></td>
            <td>KV get (auth required)</td>
          </tr>
          <tr>
            <td>POST</td>
            <td><code>/{key}</code></td>
            <td>KV set (auth required)</td>
          </tr>
          <tr>
            <td>DELETE</td>
            <td><code>/{key}</code></td>
            <td>KV delete (auth required)</td>
          </tr>
          <tr>
            <td>PUT</td>
            <td><code>/{key}</code></td>
            <td>Upload file to R2 (auth required)</td>
          </tr>
          <tr>
            <td>PURGE</td>
            <td><code>/{key}</code></td>
            <td>Delete file from R2 (auth required)</td>
          </tr>
          <tr>
            <td>PROPFIND</td>
            <td><code>/</code></td>
            <td>List R2 files (auth required)</td>
          </tr>
          <tr>
            <td>PATCH</td>
            <td><code>/{key}</code></td>
            <td>Download file from R2 (auth required)</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section>
      <h2>Example Usage</h2>
      <h3>Reactive State</h3>
      <pre><code>&lt;hello-world data="message"&gt;&lt;/hello-world&gt;
&lt;script&gt;
  window.custom['hello-world'] = (data) => `Hello ${data}`;
  window.state.message = "World"; // Automatically updates the element
&lt;/script&gt;</code></pre>

      <h3>KV Storage</h3>
      <pre><code>// Get value
const value = await window.get('my-key');

// Set value
await window.set('my-key', 'my-value');

// Delete key
await window.delete('my-key');</code></pre>

      <h3>File Operations</h3>
      <pre><code>// Upload file
await window.put('filename.txt', fileBlob);

// List files
const files = await window.list();

// Download file
await window.download('filename.txt');

// Delete file
await window.purge('filename.txt');</code></pre>
    </section>

    <section>
      <h2>Environment Variables</h2>
      <p>Create a <code>.env</code> file in the project root:</p>
      <pre><code># Auth0
AUTH0_DOMAIN=your-tenant.auth0.com
AUTH0_CLIENT_ID=your-client-id
AUTH0_CLIENT_SECRET=your-client-secret

# Cloudflare R2 (optional, for file storage)
CLOUDFLARE_ACCESS_KEY_ID=your-access-key-id
CLOUDFLARE_SECRET_ACCESS_KEY=your-secret-access-key
CLOUDFLARE_BUCKET_NAME=your-bucket-name
CLOUDFLARE_PUBLIC_URL=https://your-account-id.r2.cloudflarestorage.com</code></pre>
    </section>
  </div>

  <footer>
    <div class="container">
      <p>MIT License • Built with Bun</p>
    </div>
  </footer>
</body>
</html>

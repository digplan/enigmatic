<!DOCTYPE html>

<script src='/enigmatic@0.1.js'></script>
<link href='/enigmatic@0.1.css' rel='stylesheet'>

<meta stream='/stream'>

<div x-control='helloworld' x-datakey='name'>x</div>

<div>
  <label for='email'>Sign in with email</label>
  <input id='email' name='email' value='8477540908@tmomail.net'/>
  
  <div id='codediv' hidden>
    <div id='msg'></div>
    <label for='code'>Enter code</label>
    <input name='code' id='code' autocomplete="one-time-code"/>
    <button id='login'>Login</button>
  </div>

  <button id='getcode'>Get code</button>
</div>

<script>
   getcode.onclick = async function(){
     const email = document.getElementById('email').value;
     const r = await fetch(`/?email=${email}`);
     const j = await r.text();
     if(!j.match(/a code has been sent to/i))
       return alert('error');
     
     document.getElementById('msg').innerHTML = j;
     document.getElementById('codediv').hidden = false;
     document.getElementById('getcode').hidden = true;
   }

   login.onclick = async function(){
     const email = document.getElementById('email').value;
     const r = await fetch(`/?email=${document.getElementById('email').value}&code=${document.getElementById('code').value}`);
     const j = await r.text();
     if(j != 'Unauthorized')
       return document.location = '/';
     document.getElementById('msg').innerHTML = 'Wrong code'
   }
</script>